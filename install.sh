# =============================
# install sh
# =============================

cat << 'EOF'
                                                                          __             __
  ___ ___       __       ___             _____    _ __    ___    __  __  /\_\     ____  /\_\     ___     ___
/' __` __`\   /'__`\    /'___\  _______ /\ '__`\ /\`'__\ / __`\ /\ \/\ \ \/\ \   /',__\ \/\ \   / __`\ /' _ `\
/\ \/\ \/\ \ /\ \L\.\_ /\ \__/ /\______\\ \ \L\ \\ \ \/ /\ \L\ \\ \ \_/ | \ \ \ /\__, `\ \ \ \ /\ \L\ \/\ \/\ \
\ \_\ \_\ \_\\ \__/.\_\\ \____\\/______/ \ \ ,__/ \ \_\ \ \____/ \ \___/   \ \_\\/\____/  \ \_\\ \____/\ \_\ \_\
 \/_/\/_/\/_/ \/__/\/_/ \/____/           \ \ \/   \/_/  \/___/   \/__/     \/_/ \/___/    \/_/ \/___/  \/_/\/_/
                                           \ \_\
                                            \/_/
EOF


# =============================
# brew
# =============================

if ! which brew > /dev/null 2>&1 ; then
    cat << 'EOF'
=================================================================================================================
 Install [brew] command
=================================================================================================================
EOF
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew update
    brew doctor
fi

# =============================
# clone git repogitory
# =============================

install_dir="$HOME/src/github.com/Surume/mac-provisioning"
if [ ! -d $install_dir ]; then
    cat << 'EOF'
=================================================================================================================
 Start git clone mac-provisioning
=================================================================================================================
EOF
    git clone git@github.com:Surume/mac-provisioning.git $install_dir
fi

cd $install_dir

if [ ! -d `pwd`/dotfiles ]; then
    cat << 'EOF'
=================================================================================================================
 Start git clone dotfiles
=================================================================================================================
EOF
    git clone git@github.com:Surume/dotfiles.git `pwd`/dotfiles
fi

if ! which bundle > /dev/null 2>&1 ; then
    cat << 'EOF'
=================================================================================================================
 Install [bundler] command
=================================================================================================================
EOF
    printf "password: "
    read password
    echo "$password" | sudo -S gem install bundler
fi

cat << 'EOF'
=================================================================================================================
 Start itamae provision
=================================================================================================================
EOF
bundle exec itamae-env local -y node.yml roles/local.rb

cat << 'EOF'
=================================================================================================================
 Install latest node
=================================================================================================================
EOF
if [ ! -d ~/.nodebrew/src ]; then
    mkdir -p ~/.nodebrew/src
fi
nodebrew install-binary latest
nodebrew use latest

cat << 'EOF'
=================================================================================================================
 Install dotfiles
=================================================================================================================
EOF
if [ -d `pwd`/dotfiles ]; then
    cd `pwd`/dotfiles
    sh ~/dotfiles/install
fi
